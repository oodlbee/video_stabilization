# Быстрая стабилизация видео

Для стабилизации долгих и тяжеловесных видеофайлов с использованием библиотеки OpenCV (cv2) реализован алгоритм на основе вычисления матриц евклидовых преобразований, включающих поворот и смещение изображения. Для ускорения работы программы, были реализованы следующие оптимизации:

## Основные оптимизации

1. **Масштабирование изображения**  
   Для расчетов используется уменьшенный масштаб (параметр `scale`), что ускоряет обработку, поскольку вычисления производятся на меньшем количестве данных. После получения итоговых матриц трансформации сдвиги масштабируются обратно, делением на `scale`.

2. **Работа с ключевыми кадрами**  
   Вычисление матриц трансформации производится не для каждого кадра, а только для ключевых кадров с заданным интервалом (`step`). На основе полученной матрицы трансформации для двух ключевых кадров промежуточные трансформации для остальных кадров интервала рассчитываются с помощью равномерного распределения изменений.  

   Например, если рассчитана матрица трансформации \( M \) между первым и десятым кадром, то для промежуточных кадров (1–10) трансформации определяются как доли \( M/10 \). В итоге сумма трансформаций для всех промежуточных кадров равна \( M \).

3. **Асинхронная запись видео**  
   Запись стабилизированного видео производится в отдельном потоке, чтобы минимизировать задержки, возникающие из-за операций ввода-вывода.

## Результаты

15-минутное видео (28 тысяч кадров) с параметрами `scale=0.5` и `step=100` стабилизируется за **15 минут** без записи выходного файла. С одновременной записью итоговое время обработки составляет **33 минуты**.  

Дополнительная оптимизация работы программы может включать в себя оптимизацию записи видеофайла - снижение частоты кадров, выбор более эффективного кодека или иных настроек качества.

## Результат
Сырое видео

![day_light_traffic_speed_up-ezgif com-optimize (1)](https://github.com/user-attachments/assets/bf9dc4e8-c74d-4280-8671-dbe24d1fede5)

Стабилизированное видео

![day_light_traffic_stabilized_speed_up-ezgif com-optimize](https://github.com/user-attachments/assets/ca13fdd6-b13a-44ab-9cc3-211c80342607)
